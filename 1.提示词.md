# AI 智能推荐系统实现提示词

## 项目背景
我正在开发一个基于 Next.js 14 + React 的多分类推荐平台（MVP2 项目），目前已实现基础的用户认证、订阅系统和简单的分类推荐功能。现在需要升级为 **AI 智能匹配推荐系统**。

## 核心需求

### 1. AI 个性化推荐引擎
- 基于用户历史选择记录，使用 AI 进行智能分析和个性化推荐
- 支持 5 个分类：娱乐、购物、美食、旅行、健身
- 每次推荐需要附带**可点击的外部链接**，直接跳转到相关资源

### 2. 推荐内容要求
每条推荐必须包含以下字段：
- `title`: 推荐标题
- `description`: 详细描述
- `category`: 所属分类
- `link`: **可点击的外部链接**（重要！）
- `linkType`: 链接类型（商品/视频/书籍/地点等）
- `metadata`: 额外信息（价格/评分/时长/卡路里等）
- `reason`: AI 推荐理由（基于用户偏好）

### 3. 分类链接示例

#### 娱乐类
- 小说 → 豆瓣读书/Amazon Books/京东图书链接
- 游戏 → Steam/Epic/Switch eShop 链接
- 电影 → 豆瓣电影/IMDb/Netflix 链接
- 音乐 → Spotify/Apple Music/网易云音乐链接

#### 购物类
- 服装 → 淘宝/京东/Amazon 商品链接
- 电子产品 → 官网/电商平台链接
- 家居 → 宜家/亚马逊家居链接

#### 美食类
- 餐厅 → 大众点评/Google Maps/Yelp 链接
- 食谱 → 下厨房/YouTube 视频链接

#### 旅行类
- 景点 → Google Maps/携程/TripAdvisor 链接
- 酒店 → Booking.com/Airbnb 链接

#### 健身类
- 课程 → YouTube 视频/Keep App 链接
- 健身房 → Google Maps 位置链接

## 技术实现要求

### 数据库设计
请创建以下数据表（Supabase）：

```sql
-- 用户推荐历史表
CREATE TABLE recommendation_history (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  category TEXT NOT NULL,
  title TEXT NOT NULL,
  description TEXT,
  link TEXT NOT NULL,  -- 外部链接
  link_type TEXT,
  metadata JSONB,
  clicked BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT NOW()
);

-- 用户偏好表
CREATE TABLE user_preferences (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  category TEXT NOT NULL,
  preferences JSONB,  -- 存储用户的偏好标签
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 推荐点击记录表
CREATE TABLE recommendation_clicks (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  recommendation_id UUID REFERENCES recommendation_history(id),
  clicked_at TIMESTAMP DEFAULT NOW()
);
```

### API 路由设计

#### 1. AI 推荐 API
`/api/recommend/ai/[category]` (GET)
- 输入：category, userId
- 逻辑：
  - 获取用户历史记录（最近 20 条）
  - 分析用户偏好标签
  - 调用 AI API（Anthropic Claude/OpenAI）生成个性化推荐
  - 返回 3-5 条推荐，每条必含**真实可用的外部链接**

#### 2. 记录用户选择 API
`/api/recommend/record` (POST)
- 输入：{ userId, category, recommendation, action: 'view' | 'click' }
- 功能：记录用户行为，更新偏好模型

#### 3. 用户偏好分析 API
`/api/preferences/[userId]` (GET)
- 返回用户在各分类下的偏好标签和统计

### AI 集成方案：智谱AI
async function getAIRecommendation(userHistory, category) {
  const prompt = `你是一个智能推荐助手。
用户历史选择：${JSON.stringify(userHistory)}
分类：${category}

请基于用户历史，推荐 3 个${category}相关内容，必须包含：
1. 真实可访问的外部链接（电商/视频/地图等）
2. 推荐理由（为什么适合这个用户）
3. 详细描述和元数据

返回 JSON 格式：
[{
  "title": "...",
  "description": "...",
  "link": "https://...",
  "linkType": "product|video|book|location",
  "metadata": {"price": "...", "rating": ...},
  "reason": "基于你之前喜欢..."
}]`;

  const completion = await groq.chat.completions.create({
    messages: [{ role: "user", content: prompt }],
    model: "llama-3.3-70b-versatile", // 免费且强大
    temperature: 0.7,
    max_tokens: 2000
  });

  return JSON.parse(completion.choices[0].message.content);
}
```


**推荐选择**：
glm-4-flash


### 前端组件改造

#### 1. 推荐卡片组件升级
位置：`/components/RecommendationCard.tsx`
```typescript
interface RecommendationCardProps {
  title: string;
  description: string;
  link: string;  // 新增
  linkType: string;  // 新增
  metadata: any;
  reason?: string;  // AI 推荐理由
  onLinkClick: () => void;  // 跟踪点击
}
```

特性：
- 显示外部链接图标
- 点击链接在新标签页打开
- 记录点击行为
- 显示"为什么推荐给你"标签

#### 2. 分类页面升级
位置：`/app/category/[id]/page.tsx`
- 集成新的 AI 推荐 API
- 显示推荐理由
- 添加"为什么是这个？"提示
- 点击链接跟踪

### 配置要求

#### 环境变量
```env
# 免费 AI API（选一个）
GROQ_API_KEY=your_groq_api_key  # 推荐：https://console.groq.com
# 或
HUGGINGFACE_API_KEY=your_hf_key  # https://huggingface.co/settings/tokens
# 或
TOGETHER_API_KEY=your_together_key  # https://api.together.xyz
# 或
OPENROUTER_API_KEY=your_openrouter_key  # https://openrouter.ai

# 现有配置
NEXT_PUBLIC_SUPABASE_URL=...
SUPABASE_SERVICE_ROLE_KEY=...
```


## 实现步骤建议

### Phase 1: 数据库和 API（优先）
1. 创建数据库表结构
2. 实现用户行为记录 API
3. 实现偏好分析逻辑

### Phase 2: AI 集成
1. 集成 Claude/GPT API
2. 设计推荐 prompt
3. 实现推荐生成逻辑
4. **确保返回真实可用的外部链接**

### Phase 3: 前端改造
1. 升级推荐卡片组件
2. 添加链接点击功能
3. 显示推荐理由
4. 用户反馈机制

### Phase 4: 优化
1. 链接有效性检查
2. 缓存推荐结果
3. 性能优化
4. 用户偏好更新策略

## 关键注意事项

1. **链接真实性**：确保每条推荐的链接都是真实可访问的，不能是占位符
2. **区域适配**：
   - 国际版：使用 Amazon、Google Maps、Spotify 等
   - 中国版：使用淘宝、京东、高德地图、网易云等
3. **隐私保护**：用户历史数据加密存储
4. **性能**：AI 推荐可能较慢，需要添加 loading 状态
5. **降级策略**：AI 失败时回退到规则推荐
6. **链接安全**：验证外部链接安全性，防止恶意链接

## 期望输出

请帮我：
1. 创建完整的数据库迁移脚本
2. 实现 AI 推荐 API（包含真实链接生成）
3. 升级前端推荐组件
4. 添加用户行为跟踪
5. 实现偏好学习算法
6. 提供测试数据和示例

## 当前项目状态参考
- 已有基础推荐功能（`/api/recommend/[category]`）
- 已有用户认证系统（Supabase Auth）
- 已有分类页面（`/app/category/[id]/page.tsx`）
- 使用 TypeScript + Next.js 14 App Router
- UI 使用 Radix UI + Tailwind CSS

---

先浏览整个项目，再基于以上需求，帮我完善这个项目。重点是：**每条推荐必须包含可点击的真实外部链接**。
