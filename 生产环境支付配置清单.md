# ç”Ÿäº§ç¯å¢ƒæ”¯ä»˜åŠŸèƒ½é…ç½®æ¸…å•
**åŸŸå**: https://random-life-seven.vercel.app
**éƒ¨ç½²åŒºåŸŸ**: å›½é™…ç‰ˆ (INTL)
**æœ€åæ›´æ–°**: 2025-12-16

## ğŸ“‹ ç›®å½•
- [ç¯å¢ƒå˜é‡é…ç½®](#ç¯å¢ƒå˜é‡é…ç½®)
- [Stripe é…ç½®](#stripe-é…ç½®)
- [PayPal é…ç½®](#paypal-é…ç½®)
- [Webhook é…ç½®](#webhook-é…ç½®)
- [Vercel éƒ¨ç½²é…ç½®](#vercel-éƒ¨ç½²é…ç½®)
- [å®‰å…¨æ£€æŸ¥æ¸…å•](#å®‰å…¨æ£€æŸ¥æ¸…å•)
- [æµ‹è¯•æµç¨‹](#æµ‹è¯•æµç¨‹)

---

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

### å¿…é¡»åœ¨ Vercel ä¸­é…ç½®çš„ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ˜¯å¦å¿…éœ€ |
|--------|------|---------|----------|
| `NEXT_PUBLIC_DEPLOYMENT_REGION` | éƒ¨ç½²åŒºåŸŸ | `INTL` | âœ… |
| `NEXT_PUBLIC_SUPABASE_URL` | Supabase é¡¹ç›® URL | `https://xxx.supabase.co` | âœ… |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Supabase åŒ¿åå¯†é’¥ | `eyJhbGciOi...` | âœ… |
| `SUPABASE_SERVICE_ROLE_KEY` | Supabase æœåŠ¡ç«¯å¯†é’¥ | `eyJhbGciOi...` | âœ… |
| `NEXTAUTH_SECRET` | NextAuth å¯†é’¥ | `éšæœºç”Ÿæˆçš„å­—ç¬¦ä¸²` | âœ… |
| `NEXTAUTH_URL` | NextAuth URL | `https://random-life-seven.vercel.app` | âœ… |

### Stripe æ”¯ä»˜é…ç½®

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ˜¯å¦å¿…éœ€ |
|--------|------|---------|----------|
| `STRIPE_SECRET_KEY` | Stripe ç§é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ | `sk_live_...` | âœ… |
| `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY` | Stripe å…¬é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ | `pk_live_...` | âœ… |
| `STRIPE_WEBHOOK_SECRET` | Stripe Webhook å¯†é’¥ | `whsec_...` | âœ… |
| `STRIPE_PRO_PRICE_ID` | Pro è®¡åˆ’ä»·æ ¼ ID | `price_xxx` | âœ… |
| `STRIPE_ENTERPRISE_PRICE_ID` | Enterprise è®¡åˆ’ä»·æ ¼ ID | `price_xxx` | âœ… |

### PayPal æ”¯ä»˜é…ç½®

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ˜¯å¦å¿…éœ€ |
|--------|------|---------|----------|
| `PAYPAL_CLIENT_ID` | PayPal å®¢æˆ·ç«¯ IDï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ | `Axxxxxxxx...` | âœ… |
| `PAYPAL_CLIENT_SECRET` | PayPal å®¢æˆ·ç«¯å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ | `xxxxxxxx...` | âœ… |
| `PAYPAL_WEBHOOK_ID` | PayPal Webhook ID | `xx-xxxx-xxxxx` | âœ… |
| `PAYPAL_PRO_PLAN_ID` | Pro è®¢é˜…è®¡åˆ’ ID | `P-xxxxxxxxxx` | âœ… |
| `PAYPAL_ENTERPRISE_PLAN_ID` | Enterprise è®¢é˜…è®¡åˆ’ ID | `P-xxxxxxxxxx` | âœ… |

---

## ğŸ’³ Stripe é…ç½®

### 1. è·å–ç”Ÿäº§ç¯å¢ƒå¯†é’¥

1. ç™»å½• [Stripe Dashboard](https://dashboard.stripe.com/)
2. åœ¨å·¦ä¸‹è§’åˆ‡æ¢åˆ° **Live mode**
3. è·å–å¯†é’¥ï¼š
   - API Keys â†’ Publishable key (`pk_live_...`)
   - API Keys â†’ Secret key (`sk_live_...`)

### 2. åˆ›å»ºäº§å“å’Œä»·æ ¼

#### Pro è®¡åˆ’ï¼ˆ$9.99/æœˆï¼‰
```bash
# åˆ›å»ºäº§å“
stripe products create name="Pro Plan" type="service"

# åˆ›å»ºä»·æ ¼
stripe prices create \
  --product=prod_xxx \
  --currency=usd \
  --unit-amount=999 \
  --recurring="{\"interval\":\"month\"}"
```

#### Enterprise è®¡åˆ’ï¼ˆ$49.99/æœˆï¼‰
```bash
# åˆ›å»ºäº§å“
stripe products create name="Enterprise Plan" type="service"

# åˆ›å»ºä»·æ ¼
stripe prices create \
  --product=prod_xxx \
  --currency=usd \
  --unit-amount=4999 \
  --recurring="{\"interval\":\"month\"}"
```

### 3. é…ç½® Webhook

1. åœ¨ Stripe Dashboard â†’ Webhooks â†’ Add endpoint
2. Endpoint URL: `https://random-life-seven.vercel.app/api/stripe/webhook`
3. ç›‘å¬äº‹ä»¶ï¼š
   - `payment_intent.succeeded`
   - `payment_intent.payment_failed`
   - `invoice.payment_succeeded`
   - `invoice.payment_failed`
   - `customer.subscription.created`
   - `customer.subscription.updated`
   - `customer.subscription.deleted`
4. è·å– Webhook ç­¾åå¯†é’¥ (`whsec_...`)

---

## ğŸ…¿ï¸ PayPal é…ç½®

### 1. åˆ›å»ºç”Ÿäº§ç¯å¢ƒåº”ç”¨

1. ç™»å½• [PayPal Developer Dashboard](https://developer.paypal.com/)
2. åˆ‡æ¢åˆ° **Live** æ ‡ç­¾
3. Apps & Credentials â†’ Create App
4. é€‰æ‹©å¹³å°ï¼š**Merchant**
5. è·å–ï¼š
   - Client ID
   - Client Secret

### 2. åˆ›å»ºè®¢é˜…è®¡åˆ’

#### Pro è®¡åˆ’ï¼ˆ$9.99/æœˆï¼‰
```javascript
// ä½¿ç”¨ PayPal API åˆ›å»ºè®¡åˆ’
// æˆ–åœ¨ PayPal Business Dashboard æ‰‹åŠ¨åˆ›å»º
```

#### Enterprise è®¡åˆ’ï¼ˆ$49.99/æœˆï¼‰
```javascript
// ä½¿ç”¨ PayPal API åˆ›å»ºè®¡åˆ’
// æˆ–åœ¨ PayPal Business Dashboard æ‰‹åŠ¨åˆ›å»º
```

### 3. é…ç½® Webhook

1. ç™»å½• [PayPal Business Dashboard](https://www.paypal.com/business/)
2. è®¾ç½® â†’ API æ›´æ–° â†’ Webhook é€šçŸ¥
3. Webhook URL: `https://random-life-seven.vercel.app/api/paypal/webhook`
4. ç›‘å¬äº‹ä»¶ï¼š
   - `PAYMENT.AUTHORIZATION.CREATED`
   - `PAYMENT.AUTHORIZATION.VOIDED`
   - `BILLING.SUBSCRIPTION.CREATED`
   - `BILLING.SUBSCRIPTION.ACTIVATED`
   - `BILLING.SUBSCRIPTION.CANCELLED`

---

## ğŸŒ Webhook é…ç½®æ±‡æ€»

| æœåŠ¡ | Webhook URL | é…ç½®ä½ç½® |
|------|-------------|----------|
| Stripe | `https://random-life-seven.vercel.app/api/stripe/webhook` | Stripe Dashboard |
| PayPal | `https://random-life-seven.vercel.app/api/paypal/webhook` | PayPal Business Dashboard |

---

## ğŸš€ Vercel éƒ¨ç½²é…ç½®

### 1. ç¯å¢ƒå˜é‡è®¾ç½®

1. è¿›å…¥ Vercel é¡¹ç›® â†’ Settings â†’ Environment Variables
2. æ·»åŠ ä¸Šè¿°æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼ˆé€‰æ‹© **Production** ç¯å¢ƒï¼‰
3. ç¡®ä¿æ•æ„Ÿå˜é‡ï¼ˆå¦‚å¯†é’¥ï¼‰ä¸æ·»åŠ åˆ° `.env` æ–‡ä»¶ä¸­

### 2. åŸŸåé…ç½®

- ç¡®ä¿åŸŸå `random-life-seven.vercel.app` å·²æ­£ç¡®é…ç½®
- HTTPS åº”è‡ªåŠ¨å¯ç”¨

### 3. æ„å»ºè®¾ç½®

- Build Command: `npm run build`
- Output Directory: `.next`
- Node.js Version: `18.x` æˆ–æ›´é«˜

---

## ğŸ”’ å®‰å…¨æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰ç”Ÿäº§ç¯å¢ƒå¯†é’¥å·²é…ç½®ï¼ˆä¸æ˜¯æµ‹è¯•å¯†é’¥ï¼‰
- [ ] Webhook URL ä½¿ç”¨ HTTPS
- [ ] Webhook ç­¾åéªŒè¯å·²å¯ç”¨
- [ ] ç¯å¢ƒå˜é‡ä¸åœ¨å®¢æˆ·ç«¯æš´éœ²ï¼ˆåªæœ‰ `NEXT_PUBLIC_*` å‰ç¼€çš„å¯ä»¥ï¼‰
- [ ] é”™è¯¯æ—¥å¿—ä¸­ä¸ä¼šæš´éœ²æ•æ„Ÿä¿¡æ¯
- [ ] æ”¯ä»˜å¤±è´¥å¤„ç†æœºåˆ¶å®Œå–„
- [ ] æ”¯ä»˜é‡‘é¢éªŒè¯åœ¨æœåŠ¡ç«¯è¿›è¡Œ

---

## ğŸ§ª æµ‹è¯•æµç¨‹

### 1. Stripe æµ‹è¯•

1. ä½¿ç”¨çœŸå®çš„æµ‹è¯•å¡å·ï¼š
   - æˆåŠŸæ”¯ä»˜ï¼š`4242424242424242`
   - éœ€è¦3DéªŒè¯ï¼š`4000002500003155`
   - è¢«æ‹’ç»ï¼š`4000000000000002`
2. æµ‹è¯•é‡‘é¢ï¼š
   - Pro: $9.99 USD
   - Enterprise: $49.99 USD

### 2. PayPal æµ‹è¯•

1. ä½¿ç”¨ PayPal æ²™ç›’è´¦æˆ·åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ
2. æµ‹è¯•å®Œæ•´çš„æ”¯ä»˜æµç¨‹
3. éªŒè¯è®¢é˜…åˆ›å»ºå’Œå–æ¶ˆ

### 3. æµ‹è¯•æ£€æŸ¥ç‚¹

- [ ] æ”¯ä»˜é¡µé¢æ­£ç¡®åŠ è½½
- [ ] æ”¯ä»˜æ–¹å¼é€‰æ‹©æ­£å¸¸
- [ ] æ”¯ä»˜æˆåŠŸåé‡å®šå‘æ­£ç¡®
- [ ] æ•°æ®åº“ä¸­è®¢é˜…çŠ¶æ€æ›´æ–°
- [ ] Webhook äº‹ä»¶æ­£ç¡®å¤„ç†
- [ ] é€€æ¬¾å’Œå–æ¶ˆåŠŸèƒ½æ­£å¸¸
- [ ] é‚®ä»¶é€šçŸ¥ï¼ˆå¦‚æœé…ç½®ï¼‰

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å¯†é’¥ç®¡ç†**ï¼š
   - æ°¸è¿œä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥
   - å®šæœŸè½®æ¢å¯†é’¥
   - ä½¿ç”¨ä¸åŒçš„å¯†é’¥ç”¨äºå¼€å‘å’Œç”Ÿäº§

2. **é”™è¯¯å¤„ç†**ï¼š
   - è®°å½•æ‰€æœ‰æ”¯ä»˜é”™è¯¯
   - æä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
   - å®ç°æ”¯ä»˜é‡è¯•æœºåˆ¶

3. **åˆè§„æ€§**ï¼š
   - éµå®ˆ PCI DSS è¦æ±‚
   - å®æ–½é€‚å½“çš„æ¬ºè¯ˆæ£€æµ‹
   - ä¿å­˜å¿…è¦çš„æ”¯ä»˜è®°å½•

4. **ç›‘æ§**ï¼š
   - è®¾ç½®æ”¯ä»˜æˆåŠŸ/å¤±è´¥ç‡ç›‘æ§
   - ç›‘æ§ API è°ƒç”¨é™åˆ¶
   - è®¾ç½®å¼‚å¸¸å‘Šè­¦

---

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Stripe é”™è¯¯ "No such payment_intent"**
   - æ£€æŸ¥ `STRIPE_SECRET_KEY` æ˜¯å¦ä¸ºç”Ÿäº§ç¯å¢ƒå¯†é’¥
   - ç¡®è®¤ Payment Intent ID æ­£ç¡®ä¼ é€’

2. **PayPal è¿”å› INVALID_CLIENT_ID**
   - ç¡®è®¤ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒ Client ID
   - æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®

3. **Webhook ä¸å·¥ä½œ**
   - æ£€æŸ¥ Webhook URL æ˜¯å¦å¯è®¿é—®
   - éªŒè¯ç­¾åå¯†é’¥æ˜¯å¦æ­£ç¡®
   - æŸ¥çœ‹ webhook æ—¥å¿—

---

## ğŸ“ æ”¯æŒ

- Stripe æ–‡æ¡£: https://stripe.com/docs
- PayPal å¼€å‘è€…æ–‡æ¡£: https://developer.paypal.com/docs/
- Vercel æ–‡æ¡£: https://vercel.com/docs